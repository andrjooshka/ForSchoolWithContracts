<html t:type="layout"
		t:pageTitle="Клиенты"
      xmlns:t="http://tapestry.apache.org/schema/tapestry_5_3.xsd"
      xmlns:p="tapestry:parameter">
    
    <ul class="nav child">
		<t:pagelink page="clients">
			<li>Сводка</li>
		</t:pagelink>
		<t:pagelink page="reports" class="activeMenuItem last">
			<li>Отчеты</li>
		</t:pagelink>
	</ul>
    
      
	<span style="position: absolute; top: 90px; right: 70px;">
		<t:form>
			<t:checkbox t:id="switchPages" value="switchPages" onclick="this.form.submit();"/>
			<t:label for="switchPages"/>
		</t:form>
	</span>
      
	<div style="margin-top:60px;">
	  	<h3>Осталось не более 2 занятий</h3>
	  	<t:grid source="endingLessons" model="modelOfEnding" row="client" 
	  	pagerPosition="${pagerPosition}" rowsPerPage="${rows}">
	  		<p:nameCell>
	  			<t:eventlink event="details" context="client">${client.name}</t:eventlink>
	  		</p:nameCell>
	  		<p:endingInfoCell>
	  			${endingInfo}
	  		</p:endingInfoCell>
	  	</t:grid>
	</div>
	  
	<div style="margin-top:30px;">
	  	<h3>Платеж в ближайшие 2 недели</h3>
	  	<t:grid source="schedPayments" model="modelOfPayments" row="client" 
	  	pagerPosition="${pagerPosition}" rowsPerPage="${rows}">
	  		<p:nameCell>
	  			<t:eventlink event="details" context="client">${client.name}</t:eventlink>
	  		</p:nameCell>
	  		<p:paymentsInfoCell>
				<t:loop source="client.plannedPayments" value="loopPayment">

						<t:zone t:id="paymentZone" id="paymentBody${loopPayment.id}" update="show">
							<t:if test="!editing">
								<div class="panel" style="height: 25px; min-width: 100px; margin-top: 5px; ">	
									${paymentInfo} &#09;
									(<t:eventlink event="delete" context="loopPayment" t:zone="paymentBody${loopPayment.id}">удалить</t:eventlink> |
									<t:eventlink event="edit" context="loopPayment"
									t:zone="paymentBody${loopPayment.id}">редактировать</t:eventlink>)
								</div>
							</t:if>
							<t:if test="editing">
								Платеж ${loopPayment.id} : Редактирование
								<div>
									<t:beaneditform object="loopPayment" submitlabel="message:submit-label" 
									exclude="id,contractId" t:zone="paymentBody${loopPayment.id}"/>
								</div>
							</t:if>
						</t:zone>

				</t:loop>
	  		</p:paymentsInfoCell>
	  	</t:grid>
	</div>
	  
	<div style="margin-top:30px;">
		<h3>Должники</h3>
	  	<t:grid source="debtors" model="modelOfDebtors" row="client" 
	  	pagerPosition="${pagerPosition}" rowsPerPage="${rows}">
	  		<p:nameCell>
	  			<t:eventlink event="details" context="client">${client.name}</t:eventlink>
	  		</p:nameCell>
	  		<p:debtInfoCell>
	  			${debtInfo}
			</p:debtInfoCell>
		</t:grid>
	</div>
      
</html>
