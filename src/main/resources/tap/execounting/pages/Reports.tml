<html t:type="layout" t:pageTitle="Отчеты"
	xmlns:t="http://tapestry.apache.org/schema/tapestry_5_3.xsd" xmlns:p="tapestry:parameter">
	<t:eventlink id="aj" event="AJ" />
	<t:eventlink id="ajpoll" event="AJpoll" />
	<!-- Switcher clients / reports -->
	<ul class="nav child">
		<t:pagelink page="clients">
			<li>Сводка</li>
		</t:pagelink>
		<t:pagelink page="reports" class="activeMenuItem last">
			<li>Отчеты</li>
		</t:pagelink>
	</ul>

	<!-- Tabs -->
	<ul class="tabs">
		<a href="#ending">
			<li>Договор истекает</li>
		</a>
		<a href="#ended">
			<li>Договор истек</li>
		</a>
		<a href="#payment">
			<li>Скоро платеж</li>
		</a>
		<a href="#frozen">
			<li>Замороженные</li>
		</a>
		<a href="#debtors">
			<li>Должники</li>
		</a>
	</ul>

	<!-- Switcher for tables pagination -->
	<span style="position: absolute; top: 90px; right: 70px;">
		<t:form t:id="switchPagesForm">
			<t:checkbox t:id="switchPages" value="switchPages"
				onclick="this.form.submit();" />
			<t:label for="switchPages" />
		</t:form>
	</span>

	<!-- Report tables -->
	<!-- Contract is ending -->
	<div id="ending" style="margin-top:60px;" class="datatable">
		<h3>Осталось не более 2 занятий</h3>
		<t:grid source="endingLessons" model="modelOfEnding" row="client"
			pagerPosition="${pagerPosition}" rowsPerPage="${rows}">
			<p:nameCell>
				<t:eventlink event="details" context="client">${client.name}
				</t:eventlink>
			</p:nameCell>
			<p:endingInfoCell>
				${endingInfo}
			</p:endingInfoCell>
			<p:commentCell>
				<div class="commentDate"><t:outputraw value="commentDate" /></div>
				<textarea model-clientId="${client.id}" class="cool">
					${comment}
				</textarea>
			</p:commentCell>
		</t:grid>
	</div>

	<!-- Clients which contract is ended -->
	<div id="ended" style="margin-top:60px;" class="datatable">
		<h3>Закончился абонемент</h3>
		<t:grid source="endedContracts" model="modelOfEnded" row="client"
			pagerPosition="${pagerPosition}" rowsPerPage="${rows}">
			<p:nameCell>
				<t:eventlink event="details" context="client">${client.name}
				</t:eventlink>
			</p:nameCell>
			<p:endedInfoCell>
				${endedInfo}
			</p:endedInfoCell>
			<p:commentCell>
				<div class="commentDate"><t:outputraw value="commentDate" /></div>
				<textarea model-clientId="${client.id}" class="cool">
					${comment}
				</textarea>
			</p:commentCell>
		</t:grid>
	</div>

	<!-- Who should pay in next two weeks -->
	<div id="payment" style="margin-top:30px;" class="datatable">
		<h3>Платеж в ближайшие 2 недели</h3>
		<t:grid source="schedPayments" model="modelOfPayments" row="client"
			pagerPosition="${pagerPosition}" rowsPerPage="${rows}">
			<p:nameCell>
				<t:eventlink event="details" context="client">${client.name}
				</t:eventlink>
			</p:nameCell>
			<p:paymentsInfoCell>
				<t:loop source="client.plannedPayments" value="loopPayment">
					<t:zone t:id="paymentZone" id="paymentBody${loopPaymentId}"
						update="show">
						<t:if test="loopPayment">
							<t:if test="!editing">
								<div class="panel"
									style="min-height: 45px; min-width: 100px; 
							margin-top: 5px; max-width: 300px; padding: 5px; margin: 5px;">
									${paymentInfo}
									<t:if test="loopPayment.contract.freeze">
										<br />
										По замороженному договору.
									</t:if>
									<t:if test="loopPayment.contract.canceled">
										<br />
										По расторгнутому договору.
									</t:if>
									<br />
									(
									<t:delegate to="DeleteBlock" />
									|
									<t:eventlink event="edit" context="loopPayment"
										t:zone="paymentBody${loopPayment.id}">изменить</t:eventlink>
									)
								</div>
							</t:if>
							<t:if test="editing">
								Платеж ${loopPayment.id} : Редактирование
								<div>
									<t:beaneditform object="loopPayment" t:id="paymentEditor"
										submitlabel="message:submit-label" exclude="id,contractId"
										t:zone="paymentBody${loopPayment.id}" />
								</div>
							</t:if>
						</t:if>
					</t:zone>
				</t:loop>
			</p:paymentsInfoCell>
			<p:commentCell>
				<div class="commentDate"><t:outputraw value="commentDate" /></div>
				<textarea model-clientId="${client.id}" class="cool">
					${comment}
				</textarea>
			</p:commentCell>
		</t:grid>
	</div>

	<!-- Guys with frozen contracts -->
	<div id="frozen" style="margin-top:30px;" class="datatable">
		<h3>Договор заморожен</h3>
		<t:grid source="frozenClients" model="modelOfFrozen" row="client"
			pagerPosition="${pagerPosition}" rowsPerPage="${rows}">
			<p:nameCell>
				<t:eventlink event="details" context="client">${client.name}
				</t:eventlink>
			</p:nameCell>
			<p:commentCell>
				<div class="commentDate"><t:outputraw value="commentDate" /></div>
				<textarea model-clientId="${client.id}" class="cool">
					${comment}
				</textarea>
			</p:commentCell>
		</t:grid>
	</div>

	<!-- Debtors -->
	<div id="debtors" style="margin-top:30px;">
		<h3>Должники</h3>
		<t:grid source="debtors" model="modelOfDebtors" row="client"
			pagerPosition="${pagerPosition}" rowsPerPage="${rows}">
			<p:nameCell>
				<t:eventlink event="details" context="client">${client.name}
				</t:eventlink>
			</p:nameCell>
			<p:debtInfoCell>
				${debtInfo}
			</p:debtInfoCell>
			<p:commentCell>
				<div class="commentDate"><t:outputraw value="commentDate" /></div>
				<textarea model-clientId="${client.id}" class="cool">
					${comment}
				</textarea>
			</p:commentCell>
		</t:grid>
	</div>

	<t:block t:id="confirmBlock">
		<t:eventlink event="delete" context="loopPayment.id"
			t:zone="paymentBody${loopPayment.id}">
			<span t:type="any" t:mixins="confirm" t:confirmEnabled="true"
				t:confirmMessage="message:delete-payment-confirmation-message">удалить</span>
		</t:eventlink>
	</t:block>
	<t:block t:id="authBlock">
		<t:eventlink event="delete" context="loopPayment.id"
			t:zone="paymentBody${loopPayment.id}">
			<span t:type="any" t:mixins="auth"
				t:authMessage="message:delete-payment-auth-message">удалить</span>
		</t:eventlink>
	</t:block>
</html>
